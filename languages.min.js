var fs;"undefined"!=typeof exports&&(fs=require("fs"));var Languages={current:"en",data:{},options:{},_path:null,_cache:{},set:function(id,callback){if(!this._path)throw"Initialize with `Languages.init()` before";return this.init(id,this._path,callback),this},add:function(id,path,namespace,callback){this.init(id,path,callback,{namespace:namespace})},init:function(id,path,callback,options){function getCountryCode(lang){return lang+="_"+lang.toUpperCase()}function _callback(txt){txt=txt.toString("utf8");{var json=JSON.parse(txt);json[0],json[1]}self.data[namespace]=json[0],self.options[namespace]=json[1],self._cache[namespace][id]=txt,callback&&callback.call(self)}var _path,xhr,user_lang,namespace,lang,self=this,cloneLang=[];if(options=options||{},namespace=options.namespace||"self",this._cache[namespace]={},id instanceof Array){user_lang=getCountryCode((navigator.language||navigator.userLanguage||this.current).replace(/\-.+/,""));for(var i=0;i<id.length;i++)lang=id[i],/_/.test(id[i])||(lang=getCountryCode(lang)),cloneLang.push(lang);id=-1==cloneLang.indexOf(user_lang)?cloneLang[0]:user_lang}if(/_/.test(id)||(id=getCountryCode(id)),this.current=id,"function"==typeof path&&(callback=path,path=!1),path||(path="./languages/"),this._path=path,_path=path+id+".json",this._cache[namespace][id])return _callback(this._cache[namespace][id]),this;if(fs)return callback?fs.readFile(_path,function(err,ret){if(err)throw err;_callback(ret)}):_callback(fs.readFileSync(_path)),this;try{xhr=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{xhr=new ActiveXObject("Microsoft.XMLHTTP")}catch(e2){try{xhr=new XMLHttpRequest}catch(e3){xhr=!1}}}return xhr.onreadystatechange=function(){4==xhr.readyState&&200==xhr.status&&_callback(xhr.responseText)},xhr.open("GET",_path,!0),xhr.send(),this},get:function(id,namespace){return namespace=namespace||"self",this.data[namespace]?this.data[namespace][id]:""},getPlurial:function(val,type,namespace){if(namespace=namespace||"self",val=Math.abs(val),!/^[0-9]+$/.test(val))return!1;var plurial=this.options[namespace].plurial[type];return plurial||(plurial=["s"]),val>=2&&plurial[val]?plurial[val]:val>1?plurial[0]:plurial[1]||""},format:function(){var plurial,val,m,args=arguments,i=-1,namespace=args[args.length-1],match=this.match(/%[sdp]/g);if(!match)return this;for(var j=0;j<match.length;j++)if(i++,m=match[j],"%d"==m)plurial=args[i];else if("%p"==m)break;return i=-1,this.replace(/%[sdp]([0-9]+)?/g,function(match){return i++,val="undefined"!=typeof args[i]?args[i]:match,/^%p/.test(match)&&(void 0==plurial&&(plurial=val),val=Languages.getPlurial(plurial,match.replace("%",""),namespace)),val})},require:function(module,obj){var mod=obj||require(module);return"express-hbs"==module?this.load.Handlebars(mod):mod},load:{Handlebars:function(Handlebars){return Handlebars.registerHelper("t",function(text,options){var nb=options.hash.nb,_if=options.hash.if;return void 0===nb?text.t():void 0===_if?text.t(+nb):text.t(_if,+nb)}),Handlebars},Angular:function(angular){angular.module("Languages",[]).provider("Languages",function(){this.init=Languages.init.bind(Languages),this.$get=function(){return Languages}})}}};String.prototype.t=function(arg){var type,txt,match,namespace="self";"boolean"==typeof arg?(type=this.split("|"),txt=arg?type[0]:type[1],arguments=Array.prototype.slice.call(arguments,1,arguments.length)):(txt=this,arguments=Array.prototype.slice.call(arguments,0,arguments.length));for(var w,word,words=txt.split(" "),str="",i=0;i<words.length;i++)w=words[i],(match=/(.+)\.(.+)/.exec(w))&&(namespace=match[1],w=match[2]),word=Languages.get(w,namespace),word&&(arguments.push(namespace),str+=Languages.format.apply(word,arguments));return str},"undefined"!=typeof Handlebars&&Languages.load.Handlebars(Handlebars),"undefined"!=typeof angular&&Languages.load.Angular(angular),fs&&"undefined"!=typeof exports&&(exports.Languages=Languages);